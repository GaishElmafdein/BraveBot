import asyncio
from core.ai_engine.trend_analyzer import TrendAnalyzer
from core.ai_engine.profit_calculator import ProfitCalculator

async def test_complete_ai_engine():
    """ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„"""
    
    print("ğŸš€ Testing BraveBot AI Engine...")
    print("=" * 50)
    
    # 1. Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø­Ù„Ù„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª
    print("\nğŸ” TESTING TREND ANALYZER:")
    analyzer = TrendAnalyzer()
    trending_data = await analyzer.analyze_trending_products(['electronics', 'gaming'])
    
    # 2. Ø§Ø®ØªØ¨Ø§Ø± Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
    print("\nğŸ’° TESTING PROFIT CALCULATOR:")
    calculator = ProfitCalculator()
    
    # Ø¯Ù…Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
    profitable_products = []
    
    for category, products in trending_data.items():
        for product in products[:2]:  # Ø£ÙØ¶Ù„ Ù…Ù†ØªØ¬ÙŠÙ† Ù…Ù† ÙƒÙ„ ÙØ¦Ø©
            # Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­
            analysis = calculator.calculate_comprehensive_profit(
                product_name=product['keyword'],
                amazon_price=15.99,  # Ø³Ø¹Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ
                trend_data=product
            )
            
            if analysis.profit_margin > 30:  # Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ Ø£ÙƒØ«Ø± Ù…Ù† 30%
                profitable_products.append({
                    'analysis': analysis,
                    'trend_data': product
                })
    
    # 3. Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ Ø§Ù„ÙØ±Øµ
    print("\nğŸ† TOP PROFITABLE OPPORTUNITIES:")
    print("=" * 50)
    
    profitable_products.sort(key=lambda x: x['analysis'].profit_margin, reverse=True)
    
    for i, item in enumerate(profitable_products[:5], 1):
        analysis = item['analysis']
        trend = item['trend_data']
        
        print(f"\nğŸ¥‡ #{i} - {analysis.product_name}")
        print(f"   ğŸ’° Profit: ${analysis.profit_amount:.2f} ({analysis.profit_margin:.1f}%)")
        print(f"   ğŸ“ˆ Trend Score: {trend['trend_score']:.1f}")
        print(f"   ğŸ¯ Confidence: {analysis.confidence_level:.1f}%")
        print(f"   âš ï¸ Risk: {analysis.risk_score:.1f}/100")
        print(f"   ğŸ† Competition: {analysis.competition_level}")
        
        recommendations = calculator.get_profit_recommendations(analysis)
        print(f"   ğŸ’¡ {recommendations[0] if recommendations else 'No recommendations'}")
    
    print(f"\nâœ… AI Engine Test Complete!")
    print(f"   ğŸ“Š Analyzed {len(trending_data)} categories")
    print(f"   ğŸ” Found {sum(len(products) for products in trending_data.values())} trending products")
    print(f"   ğŸ’° Identified {len(profitable_products)} profitable opportunities")
    print(f"   ğŸ¯ Success Rate: {len(profitable_products)/sum(len(products) for products in trending_data.values())*100:.1f}%")

if __name__ == "__main__":
    asyncio.run(test_complete_ai_engine())